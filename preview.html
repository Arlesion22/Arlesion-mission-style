<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Arlesion Mission Style - Preview Desain</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  margin:0;
  padding:0;
  font-family:'Poppins', sans-serif;
  background: url('background.jpg') no-repeat center center fixed;
  background-size: cover;
  color:#222;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.container {
  background: rgba(253,253,253,0.9);
  border-radius: 15px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  padding: 30px 40px;
  text-align: center;
  position: relative;
  max-width: 400px;
}

#modelImage {
  width:200px;
  height:auto;
  border-radius:10px;
  border:1px solid #ccc;
  display:block;
  margin:0 auto;
}

#previewCanvas {
  position:absolute;
  top:80px;
  left:50%;
  transform:translateX(-50%);
  width:200px;
  height:300px;
  pointer-events:none;
  image-rendering: pixelated;
  image-rendering: crisp-edges;
}

button {
  margin-top: 20px;
  padding: 10px 20px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  background: #222;
  color: #fff;
  cursor: pointer;
  transition: 0.3s;
}
button:hover { background: #555; }

/* üêæ KIWI */
.kiwi-box {
  position: fixed;
  bottom: 10px;
  left: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  z-index: 9999;
}

.kiwi-img {
  width: 140px;
  height: auto;
}

.speech-bubble {
  background: #fffaf0;
  border: 2px solid #e0b973;
  border-radius: 15px;
  padding: 12px 16px;
  font-family: 'Poppins', sans-serif;
  font-size: 14px;
  color: #4a3c2a;
  max-width: 250px;
  text-align: center;
  box-shadow: 2px 4px 10px rgba(0,0,0,0.1);
  position: relative;
  opacity: 0;
  transform: translateY(5px);
  animation: bubbleAppear 0.8s forwards;
}

.speech-bubble::after {
  content: "";
  position: absolute;
  bottom: -8px;
  left: 50%;
  transform: translateX(-50%);
  border-width: 8px 8px 0;
  border-style: solid;
  border-color: #fffaf0 transparent;
}

@keyframes bubbleAppear {
  0% { opacity: 0; transform: translateY(5px); }
  100% { opacity: 1; transform: translateY(0); }
}
</style>
</head>
<body>

<div class="container">
  <h2>Preview Desainmu</h2>
  <img src="model.jpg" alt="Model Sketch" id="modelImage">
  <canvas id="previewCanvas" width="200" height="300"></canvas>
  <p id="colorText">Warna: -</p>
  <button onclick="nextStep()">Lanjut ke Ukuran</button>
</div>

<!-- üêæ KIWI -->
<div class="kiwi-box" id="kiwiBox">
  <div class="speech-bubble" id="kiwiText"></div>
  <img src="kiwi.jpg" alt="Kiwi" class="kiwi-img">
</div>

<script>
let clientData = JSON.parse(localStorage.getItem('arlesionClient')) || {};
let selectedSiluet = clientData.siluet || null;
let selectedColor = clientData.warna || '#000000';

// Canvas setup
const canvas = document.getElementById('previewCanvas');
const ctx = canvas.getContext('2d');
ctx.imageSmoothingEnabled = false;

const siluetImg = new Image();
const modelWidth = 200;
const modelHeight = 260;
const siluetScale = 1.0;
const siluetOffsetY = 115;
const siluetOffsetX = 0;

function drawPreview() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  if (!selectedSiluet) return;
  siluetImg.src = selectedSiluet;
  siluetImg.onload = () => {
    const siluetWidth = modelWidth * siluetScale;
    const siluetHeight = siluetImg.height * (siluetWidth / siluetImg.width);
    const xPos = (modelWidth - siluetWidth) / 2 + siluetOffsetX;
    const yPos = (modelHeight - siluetHeight) / 2 + siluetOffsetY;
    ctx.drawImage(siluetImg, xPos, yPos, siluetWidth, siluetHeight);

    // Warnai siluet
    ctx.globalCompositeOperation = "source-in";
    ctx.fillStyle = selectedColor;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.globalCompositeOperation = "source-over";
  };
}

// Update teks warna
document.getElementById("colorText").textContent = "Warna: " + selectedColor;

// Lanjut ke halaman ukuran
function nextStep(){
  window.location.href = "ukuran.html";
}

// Jalankan awal
drawPreview();

// ================== KIWI ==================
const clientName = clientData.name || "Sayangku";
const kiwiText = document.getElementById("kiwiText");
const message = `Lihat nih ${clientName}üêæ! Ini hasil kombinasi siluet dan warna yang kamu pilih. Kalau udah cocok, klik lanjut ya. Tapi jangan lupa di screenshot ya!! biar bisa ditunjukin ke Arle ü§ç`;
let i = 0;

function typeEffect() {
  if (i < message.length) {
    kiwiText.innerHTML += message.charAt(i);
    i++;
    setTimeout(typeEffect, 35);
  } else {
    setTimeout(() => {
      const kiwiBox = document.getElementById("kiwiBox");
      kiwiBox.style.transition = "opacity 0.5s";
      kiwiBox.style.opacity = 0;
      kiwiBox.style.pointerEvents = "none";
    }, 2500);
  }
}

window.addEventListener("load", () => {
  setTimeout(typeEffect, 500);
});
</script>

</body>
</html>
